\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subcaption}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{
  pdfborder = {0 0 0}
}
\usepackage[
backend=biber,
style=alphabetic,
]{biblatex}

\addbibresource{NBODY.bib}

\graphicspath{{./N Body/}}
\DeclareGraphicsExtensions{.pdf,.jpeg,.jpg,.png}

\usepackage{amsmath} % equations
\usepackage{fancyhdr} % nicer page header

\setlength{\parindent}{0pt} % no paragraph indents
\setlength{\parskip}{1em} % paragraphs separated by one line

\newcommand\experiment{N-Body Simulations with REBOUND} %%%%% experiment name
\newcommand\groupno{Group 3+10}       %%%%% group number
\newcommand\names{Pratyush Singh,\\
                  Proshmit Dasputpa,\\
                  Erasyl Telman}        %%%%% full names
\newcommand\expdate{07/03/2025}    %%%%% date of experiment day

\begin{document}
\begin{titlepage}
   \begin{center}
        \vspace*{3cm}
        \Huge{\experiment}
				
        \vspace{0.5cm}
        \LARGE{Lab course protocol}
				
        \vspace{3 cm}
        \Large{\groupno}
				
        \vspace{0.25cm}
        \large{\names}
				
        \vspace{2 cm}
        \Large{\expdate}
				
        \vspace{0.25 cm}
        \Large{Advanced lab course in astronomy\\
				Eberhard Karls Universit\"at T\"ubingen}
				
				\vspace{0.1 cm}
        \Large{WiSe 2024/25}
				
       \vfill
    \end{center}
\end{titlepage}

\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{14.5pt}
\lhead{\groupno; \experiment}

\section*{Abstract}
This is optional, but never longer than half a page.

\tableofcontents
\newpage

\setcounter{page}{1}
\pagestyle{fancy}
\fancyhf{}
\rhead{\thepage}
\lhead{\groupno; \experiment}

\section{Introduction}\label{sec:intro} % labels allow references, particularly important for figures and tables
In this laboratory work numerically we solve various N-body problems using integrator software package REBOUND.


\section{Theory}\label{sec:theory}
\subsection{Classical N-Body Problem}

\subsection{Time Integrators}
Computers can calculate equations of motion for N-bodies with time integrators. Time integrators use certain algorithms to solve ODEs with discrete values of time starting from initial time $t_n$, and computers position and velocity at next time $t_n+\Delta t$. There are various numerical schemes to solve initial value problems in such way, and next subsections will give a general outlook on some of methods, since one of our tasks is to compare different time integrators.

\subsubsection{Leapfrog}

Leapfrog is second order symplectic integrator. In the first step, it calculates the next value for position at time $\Delta t/2$:

\begin{equation}
	\textbf{r}_{1/2} = \textbf{r}_0 + \textbf{v}_0 \frac{\Delta t}{2}
\end{equation}

From that slope (acceleration) $a_{1/2}$ is calculated, and next regular steps calculate velocity and position at integer and half integer steps:

\begin{equation}
	\textbf{v}_{n+1} = \textbf{v}_n + \textbf{a}_{n+1/2} \Delta t
\end{equation}

\begin{equation}
	\textbf{r}_{n+3/2} = \textbf{r}_{n+1/2} + \textbf{v}_{n+1} \Delta t
\end{equation}

And the last step for position:

\begin{equation}
	\textbf{r}_{n+1} = \textbf{r}_{n+1/2} + \textbf{v}_{n+1} \frac{\Delta t}{2}
\end{equation}

\subsubsection{IAS15, WHFast, and Gragg-Bulirsch-Stoer}

IAS15 is a non-symplectic 15th order integrator with dynamic step size. This method can compute chaotic encounters in N-body systems down to machine precision, but very computationally demanding.

Wisdom-Holman Fast (WHFast) is second-order integrator with 11th order corrector. Is is fast for integrating long evolutions with conserved energy, so it is best for systems without collisions.

Gragg-Bulirsch-Stoer is a method based on Richardson exrapolation with very high accuracy. It uses adaptive step sizes for higher accuracy, but computationally demanding.
% A short overview over the most important points of the experiment, including the answers
% to the questions (2 to 3 pages maximum plus questions).

% \begin{equation}\label{eq:H}
%      \hat{H} \psi = i \hbar \frac{\partial \Psi}{\partial t}
% \end{equation}

% \begin{align}
%      \frac{D}{D_0} &= e^{-\frac{\mu}{\rho}\rho x} \\
%     ln\left(\frac{D}{D_0}\right) &= -\frac{\mu}{\rho}\rho x \\
%     x &= \frac{-ln\left(\frac{D}{D_0}\right)}{\frac{\mu}{\rho}\rho}
% \end{align}
\subsection{REBOUND}
To simulate the N-body problem in various astrophysical contexts, we use the REBOUND software package developed by \href{https://hanno-rein.de/}{ Professor Hanno Rein}. 
REBOUND can simulate particles under the influence of their gravities. These particles can represent astrophysical bodies like stars, planets, moons, asteroids, dust particles etc\cite{rebound}. 
The documentation for REBOUND can be found at: \href{https://rebound.readthedocs.io/en/latest/}{https://rebound.readthedocs.io/en/latest/}. It provides convenient tools to study the properties and evolution of an N-body system
like the energy, angular momentum and orbital elements. 
\\ REBOUND runs natively on windows, mac and linux. This can be run in either C or Python. For our purposes
we will stick with the latter. REBOUND for python can be easily installed by \texttt{pip install rebound}.

\subsubsection{REBOUNDX}
\section{Experiment}
\subsection{Two Body Problem}
We use the simple two body problem to test various integrators in REBOUND (Leapfrog, IAS15, WHFast, Gragg-Bulirsch-Stoer) and compare the quality of the resulting outputs.
We also test the quality of the results as we change the timestep from 1 to $10^{-6}$\\
In this two body problem we simulate a moon orbiting a planet or a planet orbiting a star. Here, one body will be significantly heavier than the other. 
The energy and the angular momentum of the system should remain constant and are given as: 
\begin{equation}
   E = -\mu \frac{GM}{2a}
\end{equation}
\begin{equation}
  L = \mu \sqrt{GMa(1-e^2)}
\end{equation}
Where $\mu = \frac{m_1m_2}{M}$ is the reduced mass of the system and $M=m_1+m_2$ is the total mass.\\
From the above equations we can derive that the semi major axis and the eccentricity of the system should also remain constant as we integrate the system over time.\\
The two body problem is simulated with REBOUND as per the following procedure:

\begin{enumerate}
  \item Initialize the simulation with a chosen integrator and timestep
  \item Add the two bodies to the system with $m_1 = 1$ and $m_2 = 0.3, a=1, e=0.3 $
  \item The simulation is integrated for one orbit and 250 steps. At each step the positions, energies and orbital parameters of the system are stored.
  \item The orbit can be plotted from the stored positions of the two bodies. Various properties of the system can be plotted as a function of time.
\end{enumerate}
The code where the following procedure is implemented is given in the appendix \ref{code}.\\
Here is the orbit we obtain with the leapfrog integrator and a timestep of $10^{-3}$:
\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{2Body/2BD0.png}
  \caption{Orbit of a two body system with leapfrog integrator and timestep of $10^{-3}$. The number of data points are less dense closer to the pericenter, which means that $m_2$ is moving faster. This follows Kepler's second law.}
  \label{fig:leapfrog_1e-3}
\end{figure}
Effect of smaller timesteps is tested with the leapfrog integrator with timesteps of $1$, $10^{-1}$,$10^{-2}$, $10^{-3}$,$10^{-4}$, $10^{-5}$ and $10^{-6}$.\\
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_Energy_Consv_dt.png}
    \caption{Conservation of Energy at various timesteps. As we increase the timestep, the energy deviation from the initial value increases.}
    \label{fig:dt_e}  
  \end{subfigure}
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_L_Consv_dt.png}
    \caption{Conservation of Angular Momentum at various timesteps. Conservation of angular momentum gets worse as we decrease the timestep.}
    \label{fig:dt_L}  
  \end{subfigure}
  \caption{Conservation of Energy and Angular Momentum at various timesteps}
\end{figure}

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_const_a_dt.png}
    \caption{Semi Major Axis at various timesteps}
    \label{fig:dt_a}  
  \end{subfigure}
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_const_ecc_dt.png}
    \caption{Eccentricity at various timesteps}
    \label{fig:dt_ecc}  
  \end{subfigure}
  \caption{Constant semi major axis and eccentricity at various timesteps}
\end{figure}
Effect of different integrators is tested with a timestep of $10^{-3}$ using the leapfrog, IAS15, WHFast and Gragg-Bulirsch-Stoer integrators\\
% add figure
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_Energy_Consv_int.png}
    \caption{Conservation of Energy using different integrators}
    \label{fig:int_e}  
  \end{subfigure}
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_L_Consv_int.png}
    \caption{Conservation of Angular Momentum using different integrators}
    \label{fig:int_L}  
  \end{subfigure}
  \caption{Conservation of Energy and Angular Momentum using different integrators}
\end{figure}

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_const_a_int.png}
    \caption{Semi Major Axis using different integrators}
    \label{fig:int_a}  
  \end{subfigure}
  \begin{subfigure}{0.49\textwidth}
    \includegraphics[height = 1.7in]{2Body/2Body_const_ecc_int.png}
    \caption{Eccentricity using different integrators} 
    \label{fig:int_ecc}  
  \end{subfigure}
  \caption{Constant semi major axis and eccentricity using different integrators}
\end{figure}
\subsection{Three Body Problem and Stability of the Planet System}
\subsection{Jupiter and Kirkwood Gaps}

In this part of the lab work we must observe Kirkwood gaps - gaps in the asteroid belt - by simulationg and observing the evolution of Sun-Jupiter-Mars system with 10000 test particles. 
Using REBOUND we can simulate these objects and get semi-major axis and eccentricity of all bodies up to 1 million years of evolution. Additionally, we check the change of distibution at every 100000 years.

Kirkwood gaps are caused by the resonant interaction between the asteroids and Jupiter. The resonant interaction leads to the instability of the orbits of the asteroids.
Moreover, the instabilities cause the increase of eccentricity of the asteroids, and the asteroids with higher eccentricity are more likely to collide with inner planets.
The main Kirkwood gaps are at 2.50, 2.82, 2.95, 3.27 AU corresponding to the resonant periods of 3:1, 5:2, 7:3, 2:1 respectively.

First, Sun, Jupiter and Mars are added with their corresponding masses, semi-major axes and eccemtricities. 
Next, we add 10000 test particles in a range of 2 to 4 AU and random true anomaly and eccentricities. It is important to make only three major objects active with $\tt sim.N\textunderscore active=3$ line so all test particles do not affect the system. 
Additionally, we simplify the solution by using leap-frog integrator due to the complicatied computation. The code records the values of semi-major axis $a$ and eccentricity $a$ of each body to .txt file for further visualization.

\begin{figure}[ht]
  \centering
  \includegraphics[width=\linewidth]{kirkwood/hist_kirkwood.png}
  \caption{Histograms of the number of asteroids at various distances every $10^5$ years. Red vertical lines correspond to actual Kirkwood gaps at 2.50, 2.82, 2.95, 3.27 AU.}
  \label{fig:kirkwood_histogram}
\end{figure}

Fig. \ref{fig:kirkwood_histogram} shows the histograms of the number of asteroids at various distances every $10^5$ years.
End result does not show the exact Kirkwood gaps due to the short timespan of the simulation and simplifications in the model and integrator. However, there are smaller number of asteroids near the expected respnance locations, especially near 2.82 AU and 2.95 AU.

Further, we can plot the semi-major axis and eccentricity of the test particles to see the evolution of the system:

\begin{figure}[ht]
  \centering
  \includegraphics[width=\linewidth]{kirkwood/a_e_kirkwood.png}
  \caption{Eccentricity vs Semi-Major Axis of asteroids over time. The gaps and smaller eccentricity at smaller semi-major axis can be seen.}
  \label{fig:kirkwood_a_e}
\end{figure}

Fig. \ref{fig:kirkwood_a_e} shows the eccentricity vs semi-major axis of the asteroids over time. One can see gaps near 2.82 and 2.95 AU as well as decrease of the eccentricity at smaller orbits.
At smaller semi-major axis, objects with higher eccentricity more likely to interact with Mars, but at some even bigger eccentricities can keep being in the system at least for $10^6$ million years.

\subsection{Resonant Capture of a Planet}
% For each experimental part:
% \begin{enumerate}
%  \item Description of setup and procedure (1 to 3 sentences each).
%  \item Tabulated measurement results.
%  \item Analysis and graphs (including detailed calculation, giving all
% formulae and values with units used).
%  \item Discussion of result (1 to 3 sentences).
% \end{enumerate}

% \subsection{Subsection}
% You might use subsections \dots

% \subsubsection{Subsubsection}
% \dots but not more than two layers.

% And please reference all figures and tables in the text, like Figure~\ref{fig:mcp} and Table~\ref{tab:ex}.

% \begin{figure}[t]
% \centering
% \includegraphics[width=.8\textwidth]{MCP-lab.jpg}
% \caption{All figures need a caption below. The caption should describe the figure and highlight important aspects, the rest is written in the main text. Each figure needs a reference in the text! If you are not the creator of the figure, put the appropriate citation in the caption}
% \label{fig:mcp}
% \end{figure}

% \begin{table}[t]
% 	\centering
% 	\caption{All tables need a caption above. The caption should describe the table and highlight important aspects, the rest is written in the main text. Each table needs a reference in the text! Units are given in the column headers.}
% 	\label{tab:ex}
% 	\begin{tabular}{cccc}
% 		\hline\noalign{\smallskip}
% 		Beam energy & $\Phi_\mathrm{nom}$ & $\Phi_\mathrm{app,HR}$ & $\Phi_\mathrm{app,AR}$ \\
% 		(keV) &  ($\mathrm{cm^2}$) & ($\mathrm{cm^2}$) & ($\mathrm{cm^2}$) \\
% 		\noalign{\smallskip}\hline\noalign{\smallskip}
% 		150  & $3.4 \cdot 10^{10}$ & $3.5 \cdot 10^{10}$ & $3.4 \cdot 10^{10}$ \\
% 		150  & $1.7 \cdot 10^{11}$ & $1.7 \cdot 10^{11}$ & $1.7 \cdot 10^{11}$ \\
% 		1400 & $7.5 \cdot 10^{8}$  & $9.9 \cdot 10^{8}$  & $7.4 \cdot 10^{8}$  \\
% 		\noalign{\smallskip}\hline
% 	\end{tabular}
% \end{table}

% Put also citations in the text wherever necessary and appropriate. Citations are to be used whenever external material is included, also in the text \cite{basic-contrib}, \cite{basic-online}, \cite{basic-DOI}, \cite{basic-journal}, \cite{basic-mono}.

\section{Conclusions}
An important section in which you should critically review the experiment and its results. Mention also parts that did not work out as expected, but keep a neutral to positive view. This can span from a few sentences to half a page.

\setcounter{secnumdepth}{0}

\printbibliography
\appendix
\section{Appendix}
\subsection{Code}
\label{code}
Please attach here your original handwritten notes and other documents created during the experiment.

\end{document}

